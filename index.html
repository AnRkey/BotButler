<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data: 'unsafe-inline' 'unsafe-eval'">
  <title>BotButler</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Basic styling for the tabs */
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      overflow: hidden;
    }

    .tabs-container {
      width: 100%;
      height: 52px;
      background-color: #F9F8F6;
      display: flex;
      flex-direction: row;
    }

    .site-buttons-container {
      display: flex;
      align-items: center;
      padding: 0 5px;
      height: 52px;
      border-right: 1px solid #ddd;
      min-width: fit-content;
    }

    .tabs-scroll-container {
      display: flex;
      overflow-x: auto;
      flex-grow: 1;
      height: 52px;
    }

    .tabs {
      display: flex;
      flex-grow: 1;
    }

    .tab {
      display: flex;
      align-items: center;
      border-right: 1px solid #ddd;
      min-width: 180px;
      max-width: 220px;
      padding: 0 10px;
      height: 40px;
      background-color: #F9F8F6;
      cursor: pointer;
      overflow: hidden;
      position: relative;
    }

    .tab.active {
      background-color: #fff;
    }

    .tab-title {
      text-overflow: ellipsis;
      white-space: nowrap;
      overflow: hidden;
      margin-right: 20px;
    }

    .tab-close {
      position: absolute;
      right: 5px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      margin: 0;
      padding: 0;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      font-size: 14px;
      cursor: pointer;
    }

    .tab-close:hover {
      background-color: #ddd;
    }

    .new-tab-button {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      width: 30px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 5px;
    }

    .new-tab-button:hover {
      background-color: #ddd;
    }

    .site-button {
      background: none;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin: 0 3px;
      padding: 2px 8px;
      font-size: 12px;
      font-weight: bold;
      cursor: pointer;
      height: 28px;
      white-space: nowrap;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .site-button:hover {
      background-color: #e6e6e6;
    }

    .site-button.grok {
      color: #000;
      border-color: #000;
    }

    .site-button.chatgpt {
      color: #10a37f;
      border-color: #10a37f;
    }

    .site-button.gemini {
      color: #8e44ad;
      border-color: #8e44ad;
    }

    .site-button.aistudio {
      color: #4285f4;
      border-color: #4285f4;
    }

    .site-button.claude {
      color: #C25000;
      border-color: #C25000;
    }

    .app-controls {
      display: flex;
      align-items: center;
      padding: 0 5px;
      height: 52px;
      border-left: 1px solid #ddd;
    }

    .aot-button {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-left: 5px;
      font-size: 12px;
      cursor: pointer;
      height: 28px;
      white-space: nowrap;
      transition: all 0.2s ease;
    }

    .aot-switch {
      position: relative;
      display: inline-block;
      width: 36px;
      height: 20px;
      margin-top: 4px;
    }

    .aot-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .aot-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 20px;
    }

    .aot-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 2px;
      bottom: 2px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .aot-slider {
      background-color: #4CAF50;
    }

    input:checked + .aot-slider:before {
      transform: translateX(16px);
    }

    .aot-label {
      font-weight: bold;
      color: #666;
      font-size: 8px;
      margin-bottom: 2px;
    }

    input:checked ~ .aot-label {
      color: #4CAF50;
    }

    .views-container {
      height: calc(100vh - 52px);
      width: 100%;
      position: relative;
    }

    .view {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
    }

    .view.active {
      display: block;
    }

    webview {
      width: 100%;
      height: 100%;
      border: none;
    }
  </style>
</head>
<body>
  <div class="tabs-container">
    <div class="site-buttons-container" id="site-buttons">
      <button class="site-button grok" id="grok-button">Grok</button>
      <button class="site-button chatgpt" id="chatgpt-button">ChatGPT</button>
      <button class="site-button gemini" id="gemini-button">Gemini</button>
      <button class="site-button aistudio" id="aistudio-button">AI Studio</button>
      <button class="site-button claude" id="claude-button">Claude</button>
    </div>
    <div class="tabs-scroll-container" id="tabs-scroll-container">
      <div class="tabs" id="tabs"></div>
    </div>
    <div class="app-controls">
      <label class="aot-button" id="aot-button">
        <span class="aot-label">Always on top</span>
        <div class="aot-switch">
          <input type="checkbox" id="aot-checkbox">
          <span class="aot-slider"></span>
        </div>
      </label>
    </div>
  </div>
  <div class="views-container" id="views"></div>

  <script>
    // Simple tab management
    const tabManager = {
      tabs: [],
      activeTabId: null,
      tabsContainer: document.getElementById('tabs'),
      tabsScrollContainer: document.getElementById('tabs-scroll-container'),
      viewsContainer: document.getElementById('views'),
      newTabButton: null,
      
      // Define site URLs
      sites: {
        grok: 'https://grok.com',
        chatgpt: 'https://chat.openai.com',
        gemini: 'https://gemini.google.com',
        aistudio: 'https://aistudio.google.com',
        claude: 'https://claude.ai'
      },
      
      init() {
        // Set up site buttons
        this.setupSiteButtons();
        
        // Create the new tab button
        this.createNewTabButton();
        
        // Set up AOT button
        const aotButton = document.getElementById('aot-button');
        const aotCheckbox = document.getElementById('aot-checkbox');
        
        // Check initial state
        const { ipcRenderer } = require('electron');
        ipcRenderer.invoke('get-always-on-top').then((isAlwaysOnTop) => {
          aotCheckbox.checked = isAlwaysOnTop;
        });
        
        // Add click handler to the checkbox directly
        aotCheckbox.addEventListener('change', () => {
          ipcRenderer.invoke('toggle-always-on-top').then((isAlwaysOnTop) => {
            aotCheckbox.checked = isAlwaysOnTop;
          });
        });
        
        // Create initial tab
        this.createTab(this.sites.grok);
      },
      
      setupSiteButtons() {
        // Set up click handlers for site buttons
        document.getElementById('grok-button').addEventListener('click', () => {
          this.createTab(this.sites.grok);
        });
        
        document.getElementById('chatgpt-button').addEventListener('click', () => {
          this.createTab(this.sites.chatgpt);
        });
        
        document.getElementById('gemini-button').addEventListener('click', () => {
          this.createTab(this.sites.gemini);
        });
        
        document.getElementById('aistudio-button').addEventListener('click', () => {
          this.createTab(this.sites.aistudio);
        });
        
        document.getElementById('claude-button').addEventListener('click', () => {
          this.createTab(this.sites.claude);
        });
      },
      
      createNewTabButton() {
        // Create the new tab button if it doesn't exist
        if (!this.newTabButton) {
          this.newTabButton = document.createElement('button');
          this.newTabButton.className = 'new-tab-button';
          this.newTabButton.textContent = '+';
          this.newTabButton.addEventListener('click', () => {
            this.createTab(this.sites.grok);
          });
        }
        
        // Add it to the tabs container
        this.tabsContainer.appendChild(this.newTabButton);
      },
      
      updateNewTabButtonPosition() {
        // Move the new tab button to the end of the tabs list
        if (this.newTabButton && this.newTabButton.parentNode) {
          this.newTabButton.parentNode.removeChild(this.newTabButton);
        }
        this.tabsContainer.appendChild(this.newTabButton);
      },
      
      createTab(url) {
        const tabId = 'tab-' + Date.now();
        
        // Create tab element
        const tabElement = document.createElement('div');
        tabElement.className = 'tab';
        tabElement.id = tabId;
        tabElement.innerHTML = `
          <div class="tab-title">New Tab</div>
          <button class="tab-close">Ã—</button>
        `;
        
        // Create view element with webview
        const viewElement = document.createElement('div');
        viewElement.className = 'view';
        viewElement.id = 'view-' + tabId;
        
        const webview = document.createElement('webview');
        webview.src = url;
        webview.partition = 'persist:botbutler';
        
        viewElement.appendChild(webview);
        
        // Add to DOM - insert before the new tab button
        this.tabsContainer.appendChild(tabElement);
        this.viewsContainer.appendChild(viewElement);
        
        // Update the new tab button position
        this.updateNewTabButtonPosition();
        
        // Set up event listeners
        tabElement.addEventListener('click', (e) => {
          if (!e.target.classList.contains('tab-close')) {
            this.activateTab(tabId);
          }
        });
        
        tabElement.querySelector('.tab-close').addEventListener('click', () => {
          this.closeTab(tabId);
        });
        
        // Set up webview events
        webview.addEventListener('page-title-updated', (e) => {
          const titleElement = tabElement.querySelector('.tab-title');
          titleElement.textContent = e.title;
          titleElement.title = e.title;
        });
        
        webview.addEventListener('did-start-loading', () => {
          tabElement.classList.add('loading');
        });
        
        webview.addEventListener('did-stop-loading', () => {
          tabElement.classList.remove('loading');
        });
        
        webview.addEventListener('new-window', (e) => {
          const url = e.url;
          const internalPatterns = [
            /.*\.grok\.com.*/,
            /.*\.x\.ai.*/,
            /.*chat\.openai\.com.*/,
            /.*gemini\.google\.com.*/,
            /.*aistudio\.google\.com.*/,
            /.*claude\.ai.*/,
            /.*accounts\.google\.com.*/,
            /.*appleid\.apple\.com.*/
          ];
          
          const isInternalUrl = internalPatterns.some(pattern => pattern.test(url));
          
          if (isInternalUrl) {
            this.createTab(url);
          } else {
            require('electron').shell.openExternal(url);
          }
        });
        
        // Store tab info
        this.tabs.push({
          id: tabId,
          element: tabElement,
          view: viewElement,
          webview: webview
        });
        
        // Activate the new tab
        this.activateTab(tabId);
        
        return tabId;
      },
      
      activateTab(tabId) {
        // Deactivate current active tab
        if (this.activeTabId) {
          const activeTab = this.tabs.find(tab => tab.id === this.activeTabId);
          if (activeTab) {
            activeTab.element.classList.remove('active');
            activeTab.view.classList.remove('active');
          }
        }
        
        // Activate new tab
        const tab = this.tabs.find(tab => tab.id === tabId);
        if (tab) {
          tab.element.classList.add('active');
          tab.view.classList.add('active');
          this.activeTabId = tabId;
        }
      },
      
      closeTab(tabId) {
        const tabIndex = this.tabs.findIndex(tab => tab.id === tabId);
        
        if (tabIndex !== -1) {
          const tab = this.tabs[tabIndex];
          
          // Remove from DOM
          tab.element.remove();
          tab.view.remove();
          
          // Remove from tabs array
          this.tabs.splice(tabIndex, 1);
          
          // If this was the active tab, activate another one
          if (this.activeTabId === tabId) {
            if (this.tabs.length > 0) {
              // Activate the tab to the left, or the first tab if this was the leftmost
              const newActiveIndex = Math.max(0, tabIndex - 1);
              this.activateTab(this.tabs[newActiveIndex].id);
            } else {
              this.activeTabId = null;
            }
          }
          
          // If no tabs left, create a new one
          if (this.tabs.length === 0) {
            this.createTab(this.sites.grok);
          } else {
            // Update the new tab button position
            this.updateNewTabButtonPosition();
          }
        }
      }
    };
    
    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      tabManager.init();
    });
  </script>
</body>
</html> 